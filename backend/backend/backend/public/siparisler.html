<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0">
    <title>Siparişlerim - Kurumsal Tedarikçi</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        
        body {
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #e4e8ec 100%);
            min-height: 100vh;
            padding-top: 80px;
        }

        /* Navbar */
        .navbar {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            background: white;
            box-shadow: 0 2px 20px rgba(0,0,0,0.1);
            z-index: 1000;
            padding: 15px 5%;
            display: flex;
            justify-content: space-between;
            align-items: center;
            height: 70px;
        }

        .logo {
            font-size: 22px;
            font-weight: 800;
            color: #1f2937;
            text-decoration: none;
        }

        .logo span { color: #6366f1; }

        .nav-back {
            display: flex;
            align-items: center;
            gap: 8px;
            color: #6366f1;
            text-decoration: none;
            font-weight: 600;
            font-size: 14px;
            padding: 8px 16px;
            border-radius: 8px;
            transition: background 0.3s;
        }

        .nav-back:hover { background: #f3f4f6; }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
        }

        .page-header {
            margin-bottom: 30px;
        }

        .page-header h1 {
            font-size: 2rem;
            color: #1f2937;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .page-header p {
            color: #6b7280;
            font-size: 1rem;
        }

        /* Filtreler */
        .filters {
            display: flex;
            gap: 10px;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }

        .filter-btn {
            padding: 10px 20px;
            border: 2px solid #e5e7eb;
            background: white;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 600;
            color: #6b7280;
            transition: all 0.3s;
            font-size: 14px;
        }

        .filter-btn:hover, .filter-btn.active {
            background: #6366f1;
            color: white;
            border-color: #6366f1;
        }

        /* Sipariş Kartı */
        .order-card {
            background: white;
            border-radius: 16px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
            border: 1px solid #e5e7eb;
            transition: transform 0.3s, box-shadow 0.3s;
        }

        .order-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.12);
        }

        .order-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #f3f4f6;
            flex-wrap: wrap;
            gap: 10px;
        }

        .order-info h3 {
            font-size: 1.1rem;
            color: #1f2937;
            margin-bottom: 5px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .order-info .order-date {
            font-size: 13px;
            color: #6b7280;
        }

        .order-status {
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .status-completed {
            background: #d1fae5;
            color: #065f46;
        }

        .status-pending {
            background: #fef3c7;
            color: #92400e;
        }

        .status-processing {
            background: #dbeafe;
            color: #1e40af;
        }

        .status-cancelled {
            background: #fee2e2;
            color: #991b1b;
        }

        /* Sipariş Ürünleri */
        .order-items {
            margin-bottom: 20px;
        }

        .order-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 12px 0;
            border-bottom: 1px solid #f3f4f6;
        }

        .order-item:last-child {
            border-bottom: none;
        }

        .item-icon {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 20px;
            flex-shrink: 0;
        }

        .item-details {
            flex: 1;
        }

        .item-details h4 {
            font-size: 15px;
            color: #1f2937;
            margin-bottom: 3px;
        }

        .item-details p {
            font-size: 13px;
            color: #6b7280;
        }

        .item-price {
            font-weight: 700;
            color: #6366f1;
            font-size: 15px;
        }

        /* Sipariş Alt Bilgi */
        .order-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-top: 15px;
            border-top: 2px solid #f3f4f6;
            flex-wrap: wrap;
            gap: 15px;
        }

        .order-total {
            font-size: 1.2rem;
            font-weight: 800;
            color: #1f2937;
        }

        .order-total span {
            color: #6366f1;
        }

        .order-actions {
            display: flex;
            gap: 10px;
        }

        .btn-action {
            padding: 10px 20px;
            border-radius: 8px;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            border: none;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .btn-primary {
            background: #6366f1;
            color: white;
        }

        .btn-primary:hover {
            background: #4f46e5;
        }

        .btn-secondary {
            background: #f3f4f6;
            color: #374151;
        }

        .btn-secondary:hover {
            background: #e5e7eb;
        }

        /* Boş Durum */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            background: white;
            border-radius: 16px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
        }

        .empty-state i {
            font-size: 64px;
            color: #d1d5db;
            margin-bottom: 20px;
        }

        .empty-state h3 {
            color: #1f2937;
            margin-bottom: 10px;
            font-size: 1.3rem;
        }

        .empty-state p {
            color: #6b7280;
            margin-bottom: 25px;
        }

        .btn-shop {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 14px 28px;
            background: #6366f1;
            color: white;
            text-decoration: none;
            border-radius: 25px;
            font-weight: 600;
            transition: all 0.3s;
        }

        .btn-shop:hover {
            background: #4f46e5;
            transform: translateY(-2px);
        }

        /* Loading */
        .loading {
            text-align: center;
            padding: 40px;
            color: #6b7280;
        }

        .loading i {
            font-size: 40px;
            animation: spin 1s linear infinite;
            color: #6366f1;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Mobil */
        @media (max-width: 768px) {
            body { padding-top: 60px; }
            
            .navbar {
                height: 60px;
                padding: 10px 15px;
            }

            .logo { font-size: 18px; }

            .container { padding: 15px; }

            .page-header h1 {
                font-size: 1.5rem;
            }

            .filters {
                gap: 8px;
            }

            .filter-btn {
                padding: 8px 16px;
                font-size: 13px;
            }

            .order-card {
                padding: 20px;
            }

            .order-header {
                flex-direction: column;
                gap: 10px;
            }

            .order-item {
                gap: 12px;
            }

            .item-icon {
                width: 45px;
                height: 45px;
                font-size: 18px;
            }

            .order-footer {
                flex-direction: column;
                align-items: flex-start;
            }

            .order-actions {
                width: 100%;
            }

            .btn-action {
                flex: 1;
                justify-content: center;
            }
        }
    </style>
</head>
<body>

    <!-- Navbar -->
    <nav class="navbar">
        <a href="index.html" class="logo">Kurumsal<span>Tedarikçi</span></a>
        <a href="profil.html" class="nav-back">
            <i class="fas fa-arrow-left"></i> Profile Dön
        </a>
    </nav>

    <!-- Container -->
    <div class="container">
        <div class="page-header">
            <h1><i class="fas fa-box-open"></i> Siparişlerim</h1>
            <p>Tüm siparişlerinizi buradan takip edebilirsiniz</p>
        </div>

        <!-- Filtreler -->
        <div class="filters">
            <button class="filter-btn active" onclick="filterOrders('all')">Tümü</button>
            <button class="filter-btn" onclick="filterOrders('pending')">Beklemede</button>
            <button class="filter-btn" onclick="filterOrders('processing')">İşleniyor</button>
            <button class="filter-btn" onclick="filterOrders('completed')">Tamamlandı</button>
        </div>

        <!-- Sipariş Listesi -->
        <div id="ordersList">
            <div class="loading">
                <i class="fas fa-spinner"></i>
                <p>Siparişler yükleniyor...</p>
            </div>
        </div>
    </div>

    <script>
        const API_URL = 'https://backend-api-7s13.onrender.com/api';

        // Kullanıcı kontrolü
        const userData = localStorage.getItem('user');
        const token = localStorage.getItem('token');

        if (!userData || !token) {
            alert('Giriş yapmanız gerekiyor!');
            window.location.href = 'giris.html';
        }

        let allOrders = [];

        // Siparişleri getir
        async function loadOrders() {
            try {
                const user = JSON.parse(userData);
                
                const response = await fetch(`${API_URL}/orders/user/${user.id || user._id}`, {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                if (!response.ok) throw new Error('Siparişler alınamadı');

                const data = await response.json();
                allOrders = data.orders || [];

                renderOrders(allOrders);
            } catch (error) {
                console.error('Sipariş yükleme hatası:', error);
                // Demo veriler (gerçek API yoksa)
                showDemoOrders();
            }
        }

        // Siparişleri render et
        function renderOrders(orders) {
            const container = document.getElementById('ordersList');

            if (orders.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-shopping-bag"></i>
                        <h3>Henüz siparişiniz yok</h3>
                        <p>Ürünleri keşfedin ve ilk siparişinizi verin!</p>
                        <a href="urunler.html" class="btn-shop">
                            <i class="fas fa-shopping-cart"></i> Alışverişe Başla
                        </a>
                    </div>
                `;
                return;
            }

            container.innerHTML = orders.map(order => `
                <div class="order-card" data-status="${order.status || 'completed'}">
                    <div class="order-header">
                        <div class="order-info">
                            <h3><i class="fas fa-hashtag"></i> Sipariş #${order.orderNumber || order._id?.slice(-6).toUpperCase()}</h3>
                            <p class="order-date">
                                <i class="far fa-calendar"></i> ${new Date(order.createdAt).toLocaleDateString('tr-TR', {
                                    year: 'numeric',
                                    month: 'long',
                                    day: 'numeric',
                                    hour: '2-digit',
                                    minute: '2-digit'
                                })}
                            </p>
                        </div>
                        <span class="order-status status-${order.status || 'completed'}">
                            ${getStatusText(order.status)}
                        </span>
                    </div>

                    <div class="order-items">
                        ${(order.items || []).map(item => `
                            <div class="order-item">
                                <div class="item-icon">
                                    <i class="fas ${item.icon || 'fa-box'}"></i>
                                </div>
                                <div class="item-details">
                                    <h4>${item.ad}</h4>
                                    <p>Adet: ${item.adet}</p>
                                </div>
                                <div class="item-price">₺${(item.fiyat * item.adet).toLocaleString('tr-TR')}</div>
                            </div>
                        `).join('')}
                    </div>

                   <!-- siparisler.html içindeki order-footer bölümünü değiştir: -->

<div class="order-footer">
    <div class="order-total">
        Toplam: <span>₺${order.total?.toLocaleString('tr-TR') || order.toplam?.toLocaleString('tr-TR')}</span>
    </div>
    <div class="order-actions">
        ${order.trackingNumber ? `
            <a href="kargo-takip.html?track=${order.trackingNumber}" class="btn-action btn-primary">
                <i class="fas fa-shipping-fast"></i> Kargo Takip
            </a>
        ` : ''}
        <button class="btn-action btn-secondary" onclick="viewOrderDetails('${order._id}')">
            <i class="fas fa-eye"></i> Detay
        </button>
        ${order.status === 'completed' ? `
            <button class="btn-action btn-primary" onclick="reorder('${order._id}')">
                <i class="fas fa-redo"></i> Tekrarla
            </button>
        ` : ''}
    </div>
</div>
                </div>
            `).join('');
        }

        // Durum metni
        function getStatusText(status) {
            const texts = {
                'pending': 'Beklemede',
                'processing': 'İşleniyor',
                'completed': 'Tamamlandı',
                'cancelled': 'İptal Edildi'
            };
            return texts[status] || 'Tamamlandı';
        }

        // Filtrele
        function filterOrders(status) {
            document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');

            if (status === 'all') {
                renderOrders(allOrders);
            } else {
                const filtered = allOrders.filter(order => order.status === status);
                renderOrders(filtered);
            }
        }

        // Sipariş detayı görüntüle
        function viewOrderDetails(orderId) {
            alert('Sipariş detayları yakında!');
        }

        // Siparişi tekrarla
        function reorder(orderId) {
            const order = allOrders.find(o => o._id === orderId);
            if (order && order.items) {
                localStorage.setItem('kurumsalSepet', JSON.stringify(order.items));
                window.location.href = 'sepet.html';
            }
        }

        // Demo siparişler (API yoksa)
        function showDemoOrders() {
            const demoOrders = [
                {
                    _id: '1',
                    orderNumber: 'KT-2024-001',
                    status: 'completed',
                    createdAt: new Date(Date.now() - 86400000 * 2),
                    items: [
                        { ad: 'E-Fatura Paketi', adet: 1, fiyat: 299, icon: 'fa-file-invoice' },
                        { ad: 'Mali Mühür', adet: 2, fiyat: 150, icon: 'fa-stamp' }
                    ],
                    total: 599
                },
                {
                    _id: '2',
                    orderNumber: 'KT-2024-002',
                    status: 'processing',
                    createdAt: new Date(Date.now() - 86400000 * 5),
                    items: [
                        { ad: 'E-İmza Sertifikası', adet: 1, fiyat: 450, icon: 'fa-signature' }
                    ],
                    total: 450
                }
            ];
            allOrders = demoOrders;
            renderOrders(demoOrders);
        }

        // Sayfa yüklendiğinde
        loadOrders();
    </script>

</body>
</html>